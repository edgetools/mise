#!/usr/bin/env sh

set -e

SCRIPT_DIR="$(
  # try to follow symlink
  bin_path="$(
    readlink "$0" || echo "$0"
  )"
  cd "$( dirname "${bin_path}" )" > /dev/null
  pwd
)"

SCRIPT_FILE="${SCRIPT_DIR}/mise.ps1"

if [ -n "${DEBUG}" ]
then
  echo >&2 "SCRIPT_DIR: ${SCRIPT_DIR}"
  echo >&2 "BIN_SCRIPT: ${BIN_SCRIPT}"
fi

# grab first argument and convert to lowercase
command_name="$(echo "${1}" | /usr/bin/env tr '[:upper:]' '[:lower:]')"
shift || :

# set -NoExit if we're running the shell
if [ "${command_name}" = "shell" ]
then
  exec /usr/bin/env pwsh -Interactive -NoLogo -NoExit -File "${SCRIPT_FILE}" ${command_name+"${command_name}"} ${@+"${@}"}
elif [ -n "${command_name}" ]
then
  exec /usr/bin/env pwsh -NonInteractive -File "${SCRIPT_FILE}" ${command_name+"${command_name}"} ${@+"${@}"}
else
  exec /usr/bin/env pwsh -NonInteractive -File "${SCRIPT_FILE}"
fi
